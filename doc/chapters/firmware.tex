%
% firmware.tex
%
% Copyright (C) 2021 by SpaceLab.
%
% EPS 2.0 Documentation
%
% This work is licensed under the Creative Commons Attribution-ShareAlike 4.0
% International License. To view a copy of this license,
% visit http://creativecommons.org/licenses/by-sa/4.0/.
%

%
% \brief Firmware project chapter.
%
% \author Gabriel Mariano Marcelino <gabriel.mm8@gmail.com>
% \author Yan castro de Azeredo <yan.ufsceel@gmail.com>
%
% \institution Universidade Federal de Santa Catarina (UFSC)
%
% \version 0.1.0
%
% \date 2021/03/07
%

\chapter{Firmware} \label{ch:firmware}

\section{Sensors and Peripherals Variables}

A list of all the variables of EPS2 with their identification number (ID) and length (in bytes) that can be read from the sensors and peripherals is seen in the \autoref{tab:eps2-variables}.

\begin{table}[!h]
    \centering
    \begin{tabular}{lcc}
        \toprule[1.5pt]
        \textbf{Variable name}                  & \textbf{ID}    &  \textbf{Length [bytes]} \\
        \midrule
        -Y and +X sides solar panel voltage     &                &  2                       \\
        -X and +Z sides solar panel voltage     &                &  2                       \\
        -Z and +Y sides solar panel voltage     &                &  2                       \\
        -Y side solar panel current             &                &  2                       \\
        +Y side solar panel current             &                &  2                       \\
        -X side solar panel current             &                &  2                       \\
        +X side solar panel current             &                &  2                       \\
        -Z side solar panel current             &                &  2                       \\
        +Z side solar panel current             &                &  2                       \\
        EPS2 circuitry and Beacon MCU current   &                &  2                       \\
        Main power buss voltage                 &                &  2                       \\
        Batteries RTD1 temperature              &                &  4                       \\
        Batteries RTD2 temperature              &                &  4                       \\
        Batteries RTD3 temperature              &                &  4                       \\
        Batteries RTD4 temperature              &                &  4                       \\
        Internal EPS2 MCU temperature           &                &  2                       \\
        Batteries voltage                       &                &  2                       \\
        Batteries current                       &                &  2                       \\
        Batteries average current               &                &  2                       \\
        Batteries accumulated current           &                &  2                       \\
        Batteries charge                        &                &  2                       \\
        Battery monitor IC temperature          &                &  2                       \\
        Batteries monitor status register       &                &  1                       \\
        Batteries monitor protection register   &                &  1                       \\
        Batteries monitor cycle counter         &                &  1                       \\
        Batteries monitor remaining active absolute capacity register   &                &  2                       \\
        Batteries monitor remaining standby absolute capacity register  &                &  2                       \\
        Batteries monitor remaining active relative capacity register   &                &  1                       \\
        Batteries monitor remaining standby relative capacity register  &                &  1                       \\
        \bottomrule[1.5pt]
    \end{tabular}
    \caption{EPS2 variables.}
    \label{tab:eps2-variables}
\end{table}


\section{Tasks}

A list of the firmware tasks can be seen in the \autoref{tab:firmware-tasks}.

\begin{table}[!h]
    \centering
    \begin{tabular}{lccccc}
        \toprule[1.5pt]
        \textbf{Name}          & \textbf{Priority} & \textbf{Initial delay [ms]} & \textbf{Period [ms]} & \textbf{Stack [bytes]} \\
        \midrule
        Startup (boot)         & Highest           & 0                           & Aperiodic            & 500                    \\
        Watchdog reset         & Lowest            & 0                           & 100                  & 128                    \\
        System reset           & High              & 0                           & 36000000             & 128                    \\
        Battery Heater Control & TBD               & 0                           & TBD                  & TBD                    \\
        Read sensors           & Medium            & 0                           & 60000                & 128                    \\
        CSP Server             & Lowest            & 0                           & 500                  & 1024                   \\
        MPPT                   & TBD               & TBD                         & TBD                  & TBD                    \\
        Beacon package         & TBD               & TBD                         & TBD                  & TBD                    \\
        \bottomrule[1.5pt]
    \end{tabular}
    \caption{Firmware tasks.}
    \label{tab:firmware-tasks}
\end{table}
